
Objetivos de aprendizado:

A invasão de sistemas é um dos objetivos mais importantes e, às vezes, o objetivo final de um invasor. 
O invasor adquire informações por meio de técnicas como pegada, varredura, enumeração e análise de vulnerabilidade
e, em seguida, usa essas informações para hackear o sistema alvo. 
Este módulo se concentrará nas ferramentas e técnicas usadas por um invasor para hackear o sistema alvo.
Ao final deste módulo, você será capaz de fazer o seguinte:

• Explicar as diferentes técnicas para obter acesso a um sistema
• Aplicar técnicas de escalonamento de privilégios
• Explicar diferentes técnicas para obter e manter acesso remoto a um sistema
• Descrever diferentes tipos de rootkits
• Explicar técnicas de esteganografia e esteganálise
• Aplicar diferentes técnicas para ocultar as evidências de comprometimento
• Aplicar várias contramedidas de invasão de sistema

Demonstrar diferentes técnicas de quebra de senha e exploração de vulnerabilidade para obter acesso ao sistema.

Ganhando acesso:

Conforme discutido no Módulo 01, a metodologia de hacking  inclui várias etapas que os invasores seguem para hackear sistemas. 
As seções a seguir discutem essas etapas com mais detalhes. 
A primeira etapa envolve o uso de diversas técnicas pelos invasores para obter acesso ao sistema alvo. 
Essas técnicas incluem quebra de senhas, exploração de buffer overflows e exploração de vulnerabilidades identificadas.

Cracking Passwords:

Autenticação Microsoft
Quando os usuários fazem login em um computador Windows, uma série de etapas são executadas para autenticação do usuário. 
O sistema operacional Windows autentica seus usuários com a ajuda de três mecanismos (protocolos) fornecidos pela Microsoft.

Security Accounts Manager (SAM) Database:

O Windows usa o banco de dados Security Accounts Manager (SAM) ou o banco de dados do Active Directory para gerenciar contas
de usuário e senhas em formato hash (um hash unidirecional). 
O sistema não armazena as senhas em formato de texto simples, 
mas em formato hash, para protegê-las de ataques. O sistema implementa o banco de dados SAM como um arquivo de registro, 
e o kernel do Windows
obtém e mantém um bloqueio exclusivo do sistema de arquivos no arquivo SAM. 
Como este arquivo consiste em um bloqueio de sistema de arquivos, 
isso fornece alguma medida de segurança para o armazenamento de senhas.
Não é possível copiar o arquivo SAM para outro local no caso de ataques online. 
Como o sistema bloqueia o arquivo SAM com um bloqueio de sistema de arquivos 
exclusivo, um usuário não pode copiá-lo ou movê-lo
enquanto o Windows estiver em execução. O bloqueio não é liberado até que o 
sistema gere uma exceção de tela azul ou o sistema operacional seja desligado.
No entanto, para disponibilizar os hashes de senha para ataques de força bruta off-line, 
os invasores podem despejar o conteúdo do disco do arquivo SAM usando várias técnicas. 
O arquivo SAM usa uma função SYSKEY (no Windows NT 4.0 e versões posteriores)
para criptografar parcialmente os hashes de senha.
Mesmo que os hackers usem técnicas de subterfúgio para descobrir o conteúdo, 
as chaves criptografadas com hash unidirecional dificultam o hack. Além disso, 
algumas versões possuem uma chave secundária, o que torna a criptografia específica para aquela cópia do SO.

NTLM Authentication:

NT LAN Manager {NTLM) é um esquema de autenticação padrão que executa a autenticação usando uma estratégia de desafio/resposta. 
Como não depende de nenhuma especificação de protocolo oficial, não há garantia de que funcione de forma eficaz em todas as situações. 
Além disso, tem sido utilizado em algumas instalações do Windows, onde funcionou com sucesso. 
A autenticação NTLM consiste em dois protocolos: protocolo de autenticação NTLM e protocolo de autenticação LAN Manager (LM). 
Esses protocolos utilizam diferentes metodologias de hash para armazenar as senhas dos usuários na base de dados SAM.

Kerberos Authentication:

Kerberos é um protocolo de autenticação de rede que fornece autenticação forte para aplicativos
cliente/servidor por meio de criptografia de chave secreta. Este protocolo fornece autenticação mútua, 
na qual tanto o servidor quanto o usuário verificam a identidade um do outro. 
As mensagens enviadas através do protocolo Kerberos são protegidas contra ataques de repetição e espionagem.
Kerberos emprega o Key Distribution Center (KDC), que é um terceiro confiável. 
Este consiste em duas partes logicamente distintas: um servidor de autenticação (AS) 
e um servidor de concessão de tickets (TGS). Kerberos usa “tickets” para provar a identidade de um usuário.
A Microsoft atualizou seu protocolo de autenticação padrão para Kerberos, que fornece uma autenticação
mais forte para aplicativos cliente/servidor do que o NTLM.

Como as senhas hash são armazenadas no Windows SAM?:

Os sistemas operacionais Windows usam um arquivo de banco de dados Security Account Manager (SAM) para armazenar senhas de usuários. 
O arquivo SAM é armazenado em %SystemRoot%/system32/config/SAM em sistemas Windows e o Windows o monta no registro na seção de registro HKLM/SAM. 
Ele armazena senhas com hash LM ou NTLM.

NTLM substitui o hash LM, que é suscetível a cracking. Novas versões do Windows ainda oferecem suporte a hashes LM para compatibilidade com versões 
anteriores no entanto, o Vista e versões posteriores do Windows desativam os hashes LM por padrão. O hash LM está em branco nas versões mais recentes do
Windows. Selecionar a opção para remover hashes LM permite uma verificação adicional durante operações de alteração de senha, mas não limpa imediatamente
os valores de hash LM do SAM. O arquivo SAM armazena um valor "fictício" em seu banco de dados, que não tem relação com a senha real do usuário e é o
mesmo para todas as contas de usuário. Não é possível calcular hashes LM para senhas com mais de 14 caracteres. Assim, o valor hash LM é definido como
um valor "fictício" quando um usuário ou administrador define uma senha com mais de 14 caracteres.


Observação: os hashes LM estão desabilitados no Windows Vista e em sistemas operacionais Windows posteriores; LM está em branco nesses sistemas.

•	NTLM Authentication Process
•	Processo de autenticação NTLM

O NTLM inclui três métodos de autenticação de resposta a desafio: LM, NTLMvl e NTLMv2, todos os quais usam a mesma técnica para autenticação. A única diferença

entre eles é o nível de criptografia. Na autenticação NTLM, o cliente e o servidor negociam um protocolo de autenticação. Isso é feito por meio do Provedor de
Suporte de Segurança (SSP) negociado


As etapas a seguir demonstram o processo e o fluxo de autenticação de cliente para um controlador de domínio usando qualquer protocolo NTLM:
O cliente digita o nome de usuário e a senha na janela de logon.

• O Windows executa a senha por meio de um algoritmo hash e gera um hash para a senha inserida na janela de logon.

• O computador cliente envia uma solicitação de login juntamente com um nome de domínio ao controlador de domínio.
• O controlador de domínio gera uma cadeia de caracteres aleatórios de 16 bytes chamada "nonce", que é enviada ao computador cliente.
• O computador cliente criptografa o nonce com um hash da senha do usuário e o envia de volta ao controlador de domínio.
• O controlador de domínio recupera o hash da senha do usuário do SAM e o utiliza para criptografar o nonce.
 O controlador de domínio compara então o valor criptografado com o valor recebido do cliente. Um valor correspondente autentica o cliente e o logon é bem-sucedido.

 Observação: a Microsoft atualizou seu protocolo de autenticação padrão para Kerberos, que fornece uma autenticação mais forte para aplicativos cliente/servidor do que o NTLM.

Autenticação Kerberos:

Kerberos é um protocolo de autenticação de rede que fornece autenticação forte para aplicativos cliente/servidor por meio de criptografia de
chave secreta, que fornece autenticação mútua. Tanto o servidor quanto o usuário verificam a identidade um do outro. As mensagens enviadas 
através deste protocolo são protegidas contra ataques de repetição e espionagem.

Kerberos emprega o KDC, que é um terceiro confiável, e consiste em duas partes logicamente distintas: um AS e um TGS. O mecanismo de
autorização do Kerberos fornece ao usuário um ticket de concessão de ticket (TGT) que serve pós-autenticação para acesso posterior a 
serviços específicos,

Single Sign-On através do qual o usuário não precisa digitar novamente a senha para acessar quaisquer serviços autorizados. Notavelmente,
não há comunicação direta entre os servidores de aplicativos e o KDC; os tickets de serviço, mesmo embalados pela TGS, só chegam ao serviço
através do cliente que se dispõe a acessá-los.

Password Cracking:

A quebra de senha é o processo de recuperação de senhas de dados transmitidos por um sistema de computador ou de dados nele armazenados. O
objetivo de quebrar uma senha pode ser ajudar um usuário a recuperar uma senha esquecida ou perdida, como medida preventiva pelos
administradores do sistema para verificar senhas facilmente quebráveis ​​ou para uso por um invasor para obter acesso não autorizado ao
sistema.
A invasão geralmente começa com tentativas de quebra de senha. Uma senha é uma informação importante necessária para acessar um sistema.
Conseqüentemente, a maioria dos invasores utiliza técnicas de quebra de senha para obter acesso não autorizado. Um invasor pode quebrar uma 
senha manualmente, adivinhando-a, ou usar ferramentas e técnicas automatizadas, como um dicionário ou um método de força bruta. A maioria
das técnicas de quebra de senhas são bem-sucedidas devido a senhas fracas ou facilmente adivinháveis.
