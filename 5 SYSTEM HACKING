
Objetivos de aprendizado:

A invasão de sistemas é um dos objetivos mais importantes e, às vezes, o objetivo final de um invasor. 
O invasor adquire informações por meio de técnicas como pegada, varredura, enumeração e análise de vulnerabilidade
e, em seguida, usa essas informações para hackear o sistema alvo. 
Este módulo se concentrará nas ferramentas e técnicas usadas por um invasor para hackear o sistema alvo.
Ao final deste módulo, você será capaz de fazer o seguinte:

• Explicar as diferentes técnicas para obter acesso a um sistema
• Aplicar técnicas de escalonamento de privilégios
• Explicar diferentes técnicas para obter e manter acesso remoto a um sistema
• Descrever diferentes tipos de rootkits
• Explicar técnicas de esteganografia e esteganálise
• Aplicar diferentes técnicas para ocultar as evidências de comprometimento
• Aplicar várias contramedidas de invasão de sistema

Demonstrar diferentes técnicas de quebra de senha e exploração de vulnerabilidade para obter acesso ao sistema.

Ganhando acesso:

Conforme discutido no Módulo 01, a metodologia de hacking  inclui várias etapas que os invasores seguem para hackear sistemas. 
As seções a seguir discutem essas etapas com mais detalhes. 
A primeira etapa envolve o uso de diversas técnicas pelos invasores para obter acesso ao sistema alvo. 
Essas técnicas incluem quebra de senhas, exploração de buffer overflows e exploração de vulnerabilidades identificadas.

Cracking Passwords:

Autenticação Microsoft
Quando os usuários fazem login em um computador Windows, uma série de etapas são executadas para autenticação do usuário. 
O sistema operacional Windows autentica seus usuários com a ajuda de três mecanismos (protocolos) fornecidos pela Microsoft.

Security Accounts Manager (SAM) Database:

O Windows usa o banco de dados Security Accounts Manager (SAM) ou o banco de dados do Active Directory para gerenciar contas
de usuário e senhas em formato hash (um hash unidirecional). 
O sistema não armazena as senhas em formato de texto simples, 
mas em formato hash, para protegê-las de ataques. O sistema implementa o banco de dados SAM como um arquivo de registro, 
e o kernel do Windows
obtém e mantém um bloqueio exclusivo do sistema de arquivos no arquivo SAM. 
Como este arquivo consiste em um bloqueio de sistema de arquivos, 
isso fornece alguma medida de segurança para o armazenamento de senhas.
Não é possível copiar o arquivo SAM para outro local no caso de ataques online. 
Como o sistema bloqueia o arquivo SAM com um bloqueio de sistema de arquivos 
exclusivo, um usuário não pode copiá-lo ou movê-lo
enquanto o Windows estiver em execução. O bloqueio não é liberado até que o 
sistema gere uma exceção de tela azul ou o sistema operacional seja desligado.
No entanto, para disponibilizar os hashes de senha para ataques de força bruta off-line, 
os invasores podem despejar o conteúdo do disco do arquivo SAM usando várias técnicas. 
O arquivo SAM usa uma função SYSKEY (no Windows NT 4.0 e versões posteriores)
para criptografar parcialmente os hashes de senha.
Mesmo que os hackers usem técnicas de subterfúgio para descobrir o conteúdo, 
as chaves criptografadas com hash unidirecional dificultam o hack. Além disso, 
algumas versões possuem uma chave secundária, o que torna a criptografia específica para aquela cópia do SO.

NTLM Authentication:

NT LAN Manager {NTLM) é um esquema de autenticação padrão que executa a autenticação usando uma estratégia de desafio/resposta. 
Como não depende de nenhuma especificação de protocolo oficial, não há garantia de que funcione de forma eficaz em todas as situações. 
Além disso, tem sido utilizado em algumas instalações do Windows, onde funcionou com sucesso. 
A autenticação NTLM consiste em dois protocolos: protocolo de autenticação NTLM e protocolo de autenticação LAN Manager (LM). 
Esses protocolos utilizam diferentes metodologias de hash para armazenar as senhas dos usuários na base de dados SAM.

Kerberos Authentication:

Kerberos é um protocolo de autenticação de rede que fornece autenticação forte para aplicativos
cliente/servidor por meio de criptografia de chave secreta. Este protocolo fornece autenticação mútua, 
na qual tanto o servidor quanto o usuário verificam a identidade um do outro. 
As mensagens enviadas através do protocolo Kerberos são protegidas contra ataques de repetição e espionagem.
Kerberos emprega o Key Distribution Center (KDC), que é um terceiro confiável. 
Este consiste em duas partes logicamente distintas: um servidor de autenticação (AS) 
e um servidor de concessão de tickets (TGS). Kerberos usa “tickets” para provar a identidade de um usuário.
A Microsoft atualizou seu protocolo de autenticação padrão para Kerberos, que fornece uma autenticação
mais forte para aplicativos cliente/servidor do que o NTLM.

Como as senhas hash são armazenadas no Windows SAM?:

Os sistemas operacionais Windows usam um arquivo de banco de dados Security Account Manager (SAM) para armazenar senhas de usuários. 
O arquivo SAM é armazenado em %SystemRoot%/system32/config/SAM em sistemas Windows e o Windows o monta no registro na seção de registro HKLM/SAM. 
Ele armazena senhas com hash LM ou NTLM.

NTLM substitui o hash LM, que é suscetível a cracking. Novas versões do Windows ainda oferecem suporte a hashes LM para compatibilidade com versões anteriores no entanto, o Vista e versões posteriores do Windows desativam os hashes LM por padrão. O hash LM está em branco nas versões mais recentes do Windows. Selecionar a opção para remover hashes LM permite uma verificação adicional durante operações de alteração de senha, mas não limpa imediatamente os valores de hash LM do SAM. O arquivo SAM armazena um valor "fictício" em seu banco de dados, que não tem relação com a senha real do usuário e é o mesmo para todas as contas de usuário. Não é possível calcular hashes LM para senhas com mais de 14 caracteres. Assim, o valor hash LM é definido como um valor "fictício" quando um usuário ou administrador define uma senha com mais de 14 caracteres.



